<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Page mapping - Wiki of Kalle</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><div class="pandoc-raw-html-block"><!-- Dark theme -->
<link href="/static/dark-theme.css" rel="stylesheet">

<!-- MathJax, math rendering -->
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Syntax highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-okaidia.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
<!-- End of head.html -->
</div><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Kalle Jillheden" name="author" /><meta content="The memory (RAM) in Linux is divided into page table entries to classify the memorys use case. This is used by the Linux kernel to take informed decisions on the memory based on its category/mapping type." name="description" /><link href="https://wiki.jillejr.tech/linux-memory-page-mapping" rel="canonical" /><meta content="Page mapping" property="og:title" /><meta content="Wiki of Kalle" property="og:site_name" /><meta content="article" property="og:type" /><script type="application/ld+json">[{"@context":"https://schema.org","itemListElement":[{"name":"Nodes","item":"https://wiki.jillejr.tech/linux-memory-nodes","@type":"ListItem","position":1},{"name":"Zones","item":"https://wiki.jillejr.tech/linux-memory-zones","@type":"ListItem","position":2},{"name":"Pages","item":"https://wiki.jillejr.tech/linux-memory-pages","@type":"ListItem","position":3}],"@type":"BreadcrumbList"},{"@context":"https://schema.org","itemListElement":[{"name":"linux/","item":"https://wiki.jillejr.tech/linux","@type":"ListItem","position":1},{"name":"Linux memory layout","item":"https://wiki.jillejr.tech/linux-memory-layout","@type":"ListItem","position":2}],"@type":"BreadcrumbList"}]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(0,181,173,0.1)}body nav.bottomPane{background-color:rgba(0,181,173,2.0e-2)}body div#footnotes{border-top-color:#00b5ad}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#00b5ad;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(0,181,173,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-01-20T21:23"><a href="linux-memory-pages">Pages</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-01-20T21:01"><a href="linux-memory-zones">Zones</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-01-20T21:37"><a href="linux-memory-nodes">Nodes</a></span></span></div></li></ul></li></ul></li><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-01-20T21:30"><a href="linux-memory-layout">Linux memory layout</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link"><a href="linux">linux/</a></span></span></div></li></ul></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Page mapping</h1><p>The memory (RAM) in Linux is divided into <a href="https://en.wikipedia.org/wiki/Page_table">page table entries</a> to classify the memorys use case. This is used by the Linux kernel to take informed decisions on the memory based on its category/mapping type.</p><p>There are 5 distinct mapping types (categories) of memory.</p><h2 id="anonymous-memory">“Anonymous” memory</h2><p>Commonly the heap and stack memory of an application. The source of the information is from the application itself, in contrast to the other mapping types that usually has a file as the source of truth.</p><h2 id="shared-memory">“Shared” memory</h2><p>Almost as a superset of anonymous memory. An application can request a chunk of shared memory that it can read and write to, just as with normal anonymous memory.</p><p>What makes shared memory special is that it can, as the name suggests, be shared. A process (application) can share a chunk of memory with a different process. The data one process writes is readable by both processes, instantaniously.</p><p>Common use cases is to have processes communicate with each other in a highly performant fashion. A form of RPC, if you will. Processes can talk to each other in numerous ways, whereas using systems such as REST APIs, GRPC, or other TCP/IP-based solutions may be more portable and easy to implement but are magnitudes slower than using shared memory.</p><h2 id="cope-on-write-memory">“Cope on write” memory</h2><p>Superset of shared memory, where the memory behaves as if it was only copied.</p><p>The process can initiate a chunk of memory to be copy-on-write memory, and all processes that this memory is shared with can read from it. So far, identical to shared memory.</p><p>Though when any of the processes writes to this chunk of memory it is first duplicated (by the kernel) before recording the written data onto that new clone. This makes the memory behave as if you only sent a chunk of memory to the different processes, while saving some memory if it’s only read by the other processes.</p><h2 id="file-backed-memory">“File backed” memory</h2><p>A cache of a files content.</p><p>Whenever you read from a file in Linux, the reading is done by the kernel that buffers the content in memory before sending it off to the process/application that requested it.</p><p>If the content of a file is requested while it is still buffered in memory, the kernel will just use the already in-memory version of the file instead. This gives a huge performance boost in a lot of use cases.</p><p>This buffering does take up as much memory as is available, but the file-backed memory is considered low-priority so if a process tries to allocate more memory than is currently free then the kernel will deallocate some file-backed memory before letting the allocation from the process complete.</p><p>Deallocating file-backed memory is totally safe for the kernel to do at any time as it builds on the assumption that the memory does have a source of truth: the file on disk. File-backed memory is updated or removed for files that has changed/been removed, so the content of a given file in memory is always up-to-date or non-existent.</p><p>This process of allocating and deallocating file-backed memory is called “swapping”. Learn <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T19:29"><a href="how-linux-uses-swap">How Linux uses swap</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span>.</p><h2 id="device-backed-memory">“Device backed” memory</h2><p>In Linux, there’s a fine line in the usage between a devices and a file. Devices are considered files, but the information obtained from a device can not live on the assumption that “if it’s discarded then we can just obtain it again by reading from the file again”.</p><p>Example would be a keyboard. If a key is pressed, that is recorded by the kernel and saved in device-backed memory to be read by a process. If the user types <span class="pandoc-raw-html-inline"><kbd></span>hello<span class="pandoc-raw-html-inline"></kbd></span>, that data is stored in memory. But if that memory was classified as low-prio, the same way as file-backed memory, then that memory would potentionally be removed in favor of for example some anonymous memory. If a process would then try to read data from this keyboard device, it may have gotten replaced with the data from the user input <span class="pandoc-raw-html-inline"><kbd></span>world<span class="pandoc-raw-html-inline"></kbd></span>, resulting in the <span class="pandoc-raw-html-inline"><kbd></span>hello<span class="pandoc-raw-html-inline"></kbd></span> input being forgotten completely.</p><h2 id="swap-memory">Swap memory</h2><p>Swap memory is not strictly memory stored in your RAM. Swap more refers to how your Linux kernel deals with running out of memory.</p><p>File-backed and anonymous memory are the only memory mappings that are affected by swap. Read more about <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T19:29"><a href="how-linux-uses-swap">How Linux uses swap</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> and how to control it via the <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T19:08"><a href="linux-memory-swappiness">Swappiness</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> setting</p><h2 id="references">References</h2><ul><li>McKay, D. (2019, December 9). <em>What Is Swappiness on Linux? (and How to Change It)</em>. How-To Geek. <a href="https://www.howtogeek.com/449691/">https://www.howtogeek.com/449691/</a></li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2021-01-20T18:32">2021-01-20</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link" title="2021-01-20T19:29"><a href="how-linux-uses-swap">How Linux uses swap</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><p>There are two <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T18:32"><a href="linux-memory-page-mapping">Page mapping</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> that take use of swap. The anonymous memory and file-backed memory.</p></div></li></ul></li><li><span class="zettel-link-container cf"><span class="zettel-link" title="2021-01-20T19:08"><a href="linux-memory-swappiness">Swappiness</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><p>Your memory on your Linux machine is divided into different mappings. (Read more about <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T18:32"><a href="linux-memory-page-mapping">Page mapping</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span>). Your anonymous and file-backed memory both can be cached to an effect on your disk and in your RAM, respectively.</p></div></li></ul></li></ul><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T21:30"><a href="linux-memory-layout">Linux memory layout</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc">Each page can have a <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T18:32"><a href="linux-memory-page-mapping">Page mapping</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span>, ex: anonymous, file-backed, device-backed.</div></li><li class="item"><div class="pandoc"><em>Parent directory zettel</em></div></li></ul></li><li><span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T21:23"><a href="linux-memory-pages">Pages</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><p>A process can request (allocate) any number of pages, but not any size other than a multiple of the page size. Upon request of the memory page it obtains its <span class="zettel-link-container folge"><span class="zettel-link" title="2021-01-20T18:32"><a href="linux-memory-page-mapping">Page mapping</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> type, based on how it’s requested.</p></div></li></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane"><div><span class="ui basic label zettel-tag" title="Tag">linux/how does memory work in linux</span><span class="ui basic label zettel-tag" title="Tag">linux/what types of memory exists in linux</span><span class="ui basic label zettel-tag" title="Tag">root/linux/memory</span></div></nav><div class="ui bottom attached icon compact inverted menu teal"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/jilleJr/wiki/edit/main/./linux/memory/linux-memory-page-mapping.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></div></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.22.2" /></a></div></div></div></body></html>